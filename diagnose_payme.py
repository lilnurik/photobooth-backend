#!/usr/bin/env python3
"""
–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å Payme
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
"""

import base64
import requests

# –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ (–û–ë–ù–û–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–±–æ—á–∏–π ID)
PAYME_MERCHANT_ID = '68413113d629feb59d31ec2d'  # ‚úÖ –†–ê–ë–û–ß–ò–ô ID –∏–∑ config.py
order_id = 'photobooth-1766460504607'
amount = 1000  # —Å—É–º—ã

print("=" * 60)
print("üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê PAYME")
print("=" * 60)

# –®–∞–≥ 1: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
amount_tiyin = int(amount * 100)
payme_str = f"m={PAYME_MERCHANT_ID};ac.order_id={order_id};a={amount_tiyin}"
print(f"\n1Ô∏è‚É£  –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:")
print(f"   {payme_str}")

# –®–∞–≥ 2: Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
payme_b64 = base64.b64encode(payme_str.encode()).decode()
print(f"\n2Ô∏è‚É£  Base64 –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:")
print(f"   {payme_b64}")

# –®–∞–≥ 3: –§–∏–Ω–∞–ª—å–Ω—ã–π URL
payme_url = f"https://checkout.paycom.uz/{payme_b64}"
print(f"\n3Ô∏è‚É£  –§–∏–Ω–∞–ª—å–Ω—ã–π URL:")
print(f"   {payme_url}")

# –®–∞–≥ 4: –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞)
decoded = base64.b64decode(payme_b64).decode()
print(f"\n4Ô∏è‚É£  –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞):")
print(f"   {decoded}")
print(f"   {'‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç!' if decoded == payme_str else '‚ùå –ù–ï —Å–æ–≤–ø–∞–¥–∞–µ—Ç!'}")

# –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
print(f"\n5Ô∏è‚É£  –ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:")
print(f"   Merchant ID: {PAYME_MERCHANT_ID}")
print(f"   –î–ª–∏–Ω–∞ ID: {len(PAYME_MERCHANT_ID)} —Å–∏–º–≤–æ–ª–æ–≤")
print(f"   Order ID: {order_id}")
print(f"   –°—É–º–º–∞ (—Å—É–º—ã): {amount}")
print(f"   –°—É–º–º–∞ (—Ç–∏–π–∏–Ω—ã): {amount_tiyin}")

# –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Payme
print(f"\n6Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Payme checkout:")
try:
    response = requests.get("https://checkout.paycom.uz/", timeout=5)
    print(f"   Status: {response.status_code}")
    if response.status_code == 200:
        print(f"   ‚úÖ Payme —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω")
    else:
        print(f"   ‚ö†Ô∏è  –ù–µ–æ–±—ã—á–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∫–æ–¥")
except Exception as e:
    print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")

# –®–∞–≥ 7: –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ URL
print(f"\n7Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞—à–µ–≥–æ URL:")
print(f"   –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:")
print(f"   {payme_url}")
print()
try:
    response = requests.get(payme_url, timeout=10, allow_redirects=True)
    print(f"   Status: {response.status_code}")
    if response.status_code == 200:
        if "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" in response.text or "–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ" in response.text:
            print(f"   ‚ùå Merchant –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω")
            print(f"   üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
            print(f"      - Merchant ID –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π")
            print(f"      - Merchant –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω")
            print(f"      - Merchant –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ñ–æ—Ç–æ–±—É–¥–∫–∏")
        elif "merchant" in response.text.lower() and "not found" in response.text.lower():
            print(f"   ‚ùå Merchant –Ω–µ –Ω–∞–π–¥–µ–Ω")
        else:
            print(f"   ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–ª–∞—Å—å")
            # –ü—Ä–æ–≤–µ—Ä–∏–º –∫—É—Å–æ—á–µ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            snippet = response.text[:500]
            if "paycom" in snippet.lower() or "payme" in snippet.lower():
                print(f"   ‚úÖ –ü–æ—Ö–æ–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Payme")
    elif response.status_code == 404:
        print(f"   ‚ùå 404 - Merchant –Ω–µ –Ω–∞–π–¥–µ–Ω")
    else:
        print(f"   ‚ö†Ô∏è  –ù–µ–æ–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç")
except Exception as e:
    print(f"   ‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å URL: {e}")

# –®–∞–≥ 8: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
print(f"\n8Ô∏è‚É£  –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:")
print()
print("   ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: '–°–µ—Ä–≤–∏—Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —É—Å–ª—É–≥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'")
print("   üí° –†–µ—à–µ–Ω–∏–µ 1: Merchant ID –æ—Ç –ø–∞—Ä—Ñ—é–º–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∞")
print("      ‚Üí –ó–∞–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç Payme")
print("      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ merchant –∞–∫—Ç–∏–≤–µ–Ω")
print("      ‚Üí –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π merchant –¥–ª—è —Ñ–æ—Ç–æ–±—É–¥–∫–∏")
print()
print("   üí° –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ merchant")
print("      ‚Üí –ö–∞—Ç–µ–≥–æ—Ä–∏—è –±–∏–∑–Ω–µ—Å–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç—å")
print("      ‚Üí Webhook URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π)")
print("      ‚Üí –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ç–∏–ø—É —Ç–æ–≤–∞—Ä–∞")
print()
print("   üí° –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º")
print("      ‚Üí –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ test-payment endpoint:")
print(f"      curl -X POST http://localhost:5000/api/test-payment/{order_id}")

# –®–∞–≥ 9: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
print(f"\n9Ô∏è‚É£  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
print()
print("   1. –í–æ–π–¥–∏—Ç–µ –≤ https://business.paycom.uz/")
print("   2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö merchants")
print(f"   3. –ù–∞–π–¥–∏—Ç–µ merchant —Å ID: {PAYME_MERCHANT_ID}")
print("   4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ —Å—Ç–∞—Ç—É—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Active)")
print("   5. –ï—Å–ª–∏ merchant –¥–ª—è –ø–∞—Ä—Ñ—é–º–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∞:")
print("      ‚Üí –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π merchant —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ñ–æ—Ç–æ–±—É–¥–∫–∏")
print("      ‚Üí –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π ID")
print("      ‚Üí –û–±–Ω–æ–≤–∏—Ç–µ –≤ backend/app.py —Å—Ç—Ä–æ–∫–∞ 24")
print()
print("   6. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ID:")
print("      ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ app.py")
print("      ‚Üí –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend")
print("      ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞")

print()
print("=" * 60)
print("üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê")
print("=" * 60)
print()
print("üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:")
print("   1. –û—Ç–∫—Ä–æ–π—Ç–µ URL –≤—ã—à–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
print("   2. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É ‚Üí –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π merchant ID")
print("   3. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã ‚Üí –≤—Å—ë –û–ö, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥—Ä—É–≥–æ–º")
print()
