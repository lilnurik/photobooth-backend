# üåê –ù–ê–°–¢–†–û–ô–ö–ê WEBHOOK –î–õ–Ø –õ–û–ö–ê–õ–¨–ù–û–ô –†–ê–ó–†–ê–ë–û–¢–ö–ò

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ö–∞—Å—Å–∞ –∞–∫—Ç–∏–≤–Ω–∞, –Ω–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞:
```
https://fbox.polito.uz/api/payme/webhook
```

–ê –≤–∞—à backend —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞:
```
http://localhost:5000
```

Payme –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ localhost –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞!

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ngrok (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok

–°–∫–∞—á–∞–π—Ç–µ: https://ngrok.com/download

–ò–ª–∏ —á–µ—Ä–µ–∑ Chocolatey:
```powershell
choco install ngrok
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok

–û—Ç–∫—Ä–æ–π—Ç–µ **–ù–û–í–´–ô –¢–ï–†–ú–ò–ù–ê–õ** –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
ngrok http 5000
```

–í—ã —É–≤–∏–¥–∏—Ç–µ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
```
Forwarding  https://abc123.ngrok.io -> http://localhost:5000
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok.io`)

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ webhook –≤ Payme

1. –ó–∞–π–¥–∏—Ç–µ: https://business.paycom.uz/
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Å—Å—É: 670a6af1a048b8a82254e446
3. –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ **"Webhook URL"** –∏–ª–∏ **"Callback URL"**
4. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞:
   ```
   https://abc123.ngrok.io/api/payme/webhook
   ```
   (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–ê–®–ò–ô ngrok URL!)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

```bash
cd "D:\fotobox+react\photobooth-magic-main\backend"
python app.py
```

### –®–∞–≥ 5: –¢–µ—Å—Ç

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–æ—Ç–æ–±—É–¥–∫—É
2. –°–æ–∑–¥–∞–π—Ç–µ QR –∫–æ–¥
3. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∏ –æ–ø–ª–∞—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Payme
4. Webhook –ø—Ä–∏–¥–µ—Ç –Ω–∞ ngrok ‚Üí localhost:5000
5. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–π–¥–µ—Ç –Ω–∞ –ø–µ—á–∞—Ç—å! ‚úÖ

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 2: –ó–∞–≥—Ä—É–∑–∏—Ç—å backend –Ω–∞ fbox.polito.uz

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É `fbox.polito.uz`:

### –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ fbox.polito.uz
cd /var/www/fbox
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É backend
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd backend
pip3 install -r requirements.txt
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend

```bash
python3 app.py
# –ò–ª–∏ —á–µ—Ä–µ–∑ gunicorn/supervisor
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ nginx

```nginx
location /api/payme/webhook {
    proxy_pass http://localhost:5000/api/payme/webhook;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 3: –í—Ä–µ–º–µ–Ω–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ test-payment

–ü–æ–∫–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ webhook, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–º—É–ª—è—Ü–∏—é:

```bash
# –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è QR –∫–æ–¥–∞:
curl -X POST http://localhost:5000/api/test-payment/photobooth-ORDER_ID
```

–≠—Ç–æ –æ–±–æ–π–¥–µ—Ç webhook –∏ —Å–∏–º—É–ª–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É.

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ webhook –¥–æ—Å—Ç—É–ø–µ–Ω

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
https://abc123.ngrok.io/api/test
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "status": "OK",
  "message": "Photobooth payment API working with SQLite"
}
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Payme –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è

–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Payme –æ–±—ã—á–Ω–æ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ **"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook"** –∏–ª–∏ **"Test connection"**.

–ù–∞–∂–º–∏—Ç–µ –µ—ë - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚úÖ —É—Å–ø–µ—à–Ω–æ.

---

## üìã –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –í–∞—Ä–∏–∞–Ω—Ç | –°–∫–æ—Ä–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –î–ª—è production |
|---------|----------|-----------|----------------|
| ngrok | ‚ö° 5 –º–∏–Ω—É—Ç | ‚≠ê –õ–µ–≥–∫–æ | ‚ùå –ù–µ—Ç |
| fbox.polito.uz | ‚è∞ 30 –º–∏–Ω—É—Ç | ‚≠ê‚≠ê –°—Ä–µ–¥–Ω–µ | ‚úÖ –î–∞ |
| test-payment | ‚ö° 1 –º–∏–Ω—É—Ç–∞ | ‚≠ê –õ–µ–≥–∫–æ | ‚ùå –ù–µ—Ç |

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –°–ï–ô–ß–ê–°:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **ngrok** (–±—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `ngrok http 5000`
3. –û–±–Ω–æ–≤–∏—Ç–µ webhook –≤ Payme –Ω–∞ ngrok URL
4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—É—é –æ–ø–ª–∞—Ç—É

**–î–ª—è production –ü–û–¢–û–ú:**
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ backend –Ω–∞ `fbox.polito.uz`
2. Webhook —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –í—Å—ë –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## ‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ –° NGROK

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: Backend
cd "D:\fotobox+react\photobooth-magic-main\backend"
python app.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: ngrok
ngrok http 5000

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –∏–∑ ngrok (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io)

# –û–±–Ω–æ–≤–∏—Ç–µ webhook –≤ Payme:
# https://abc123.ngrok.io/api/payme/webhook

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: Frontend
cd "D:\fotobox+react\photobooth-magic-main"
npm run electron:dev

# –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å webhook —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ
```

---

**–î–∞—Ç–∞:** 23.12.2025  
**–§–∞–π–ª:** D:\fotobox+react\photobooth-magic-main\backend\WEBHOOK_SETUP.md
