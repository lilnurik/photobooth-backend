# üì± TELEGRAM –ë–û–¢ - –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï

**–î–∞—Ç–∞:** 23 –¥–µ–∫–∞–±—Ä—è 2025, 05:16 UTC

---

## üéØ –¶–µ–ª–∏

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–æ–∏ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞—á–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Ñ–æ—Ç–æ —Å —Ñ–æ—Ç–æ–±—É–¥–∫–∏
3. **–°–µ—Å—Å–∏–∏** - –∫–∞–∂–¥–∞—è —Ñ–æ—Ç–æ–±—É–¥–∫–∞ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å–µ—Å—Å–∏—é
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–Ω–æ–≥–æ —Ñ–æ—Ç–æ–±—É–¥–æ–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## üìã Workflow

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–æ–∏—Ö —Ñ–æ—Ç–æ –¥–ª—è –ø–µ—á–∞—Ç–∏

```
1. –§–æ—Ç–æ–±—É–¥–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç QR –∫–æ–¥ —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å–µ—Å—Å–∏–µ–π
   ‚îî‚îÄ QR —Å–æ–¥–µ—Ä–∂–∏—Ç: https://t.me/YourBot?start=upload_SESSION_ID

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Telegram –±–æ—Ç

3. –ë–æ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: "–ó–∞–≥—Ä—É–∑–∏—Ç–µ 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏"

4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ (–º–∞–∫—Å 3 —à—Ç)

5. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ç–æ –∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å SESSION_ID

6. –§–æ—Ç–æ–±—É–¥–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ñ–æ—Ç–æ
   ‚îî‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ

7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ç–æ –∏ –ø–µ—á–∞—Ç–∞–µ—Ç
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö —Ñ–æ—Ç–æ

```
1. –ü–æ—Å–ª–µ —Å—ä—ë–º–∫–∏ —Ñ–æ—Ç–æ–±—É–¥–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç QR –∫–æ–¥
   ‚îî‚îÄ QR —Å–æ–¥–µ—Ä–∂–∏—Ç: https://t.me/YourBot?start=download_SESSION_ID

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Telegram –±–æ—Ç

3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ç–æ –≤ –≥–∞–ª–µ—Ä–µ—é
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend (Flask)

**–ù–æ–≤—ã–µ endpoints:**

```python
# –°–µ—Å—Å–∏–∏
POST   /api/session/create           # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
GET    /api/session/:id              # –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
PUT    /api/session/:id              # –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é
DELETE /api/session/:id              # –£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é

# –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
POST   /api/session/:id/photos       # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –≤ —Å–µ—Å—Å–∏—é (–æ—Ç –±–æ—Ç–∞)
GET    /api/session/:id/photos       # –ü–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ç–æ —Å–µ—Å—Å–∏–∏ (–¥–ª—è —Ñ–æ—Ç–æ–±—É–¥–∫–∏)
POST   /api/session/:id/result       # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ç–æ–≤–æ–µ —Ñ–æ—Ç–æ (–æ—Ç —Ñ–æ—Ç–æ–±—É–¥–∫–∏)
GET    /api/session/:id/result       # –ü–æ–ª—É—á–∏—Ç—å –≥–æ—Ç–æ–≤–æ–µ —Ñ–æ—Ç–æ (–¥–ª—è –±–æ—Ç–∞)
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)

**–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: sessions**

```sql
CREATE TABLE sessions (
    id TEXT PRIMARY KEY,              -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (UUID)
    kiosk_id INTEGER,                 -- ID —Ñ–æ—Ç–æ–±—É–¥–∫–∏
    type TEXT,                        -- 'upload' –∏–ª–∏ 'download'
    status TEXT,                      -- 'pending', 'ready', 'completed', 'expired'
    created_at DATETIME,              -- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
    expires_at DATETIME,              -- –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (30 –º–∏–Ω)
    telegram_user_id INTEGER,         -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    data JSON                         -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
);
```

**–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: session_photos**

```sql
CREATE TABLE session_photos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT,                  -- –°—Å—ã–ª–∫–∞ –Ω–∞ sessions.id
    photo_data BLOB,                  -- –§–æ—Ç–æ –≤ base64 –∏–ª–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
    photo_type TEXT,                  -- 'uploaded' –∏–ª–∏ 'result'
    telegram_file_id TEXT,            -- File ID –∏–∑ Telegram
    uploaded_at DATETIME,
    FOREIGN KEY (session_id) REFERENCES sessions(id)
);
```

### Telegram Bot (Python)

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `backend/telegram_bot.py`

```python
import telebot
from telebot import types
import requests
import uuid

BOT_TOKEN = "YOUR_BOT_TOKEN"
API_URL = "http://localhost:5000/api"

bot = telebot.TeleBot(BOT_TOKEN)

@bot.message_handler(commands=['start'])
def start(message):
    # –ü–∞—Ä—Å–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä: /start upload_SESSION_ID
    # –∏–ª–∏ /start download_SESSION_ID
    ...

@bot.message_handler(content_types=['photo'])
def handle_photo(message):
    # –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ç–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ backend
    ...
```

### Frontend (React)

**–ù–æ–≤—ã–µ —ç–∫—Ä–∞–Ω—ã:**

1. **UploadQrScreen.tsx** (—É–∂–µ –µ—Å—Ç—å) - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç QR –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
2. **UploadedPhotosScreen.tsx** (—É–∂–µ –µ—Å—Ç—å) - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ
3. **DownloadQrScreen.tsx** (–Ω–æ–≤—ã–π) - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç QR –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ store:**

```typescript
interface PhotoBoothState {
  // ...—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ
  
  // –ù–æ–≤–æ–µ –¥–ª—è —Å–µ—Å—Å–∏–π
  sessionId: string | null;
  sessionType: 'upload' | 'download' | null;
  uploadedPhotos: string[];  // –§–æ—Ç–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
  
  createSession: (type: 'upload' | 'download') => Promise<string>;
  pollSessionPhotos: (sessionId: string) => void;
  saveResultPhoto: (sessionId: string, photo: string) => Promise<void>;
}
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Å—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –∏—Å—Ç–µ–∫–ª–∞
3. **–õ–∏–º–∏—Ç—ã**: –º–∞–∫—Å–∏–º—É–º 3-5 —Ñ–æ—Ç–æ –Ω–∞ —Å–µ—Å—Å–∏—é
4. **–û—á–∏—Å—Ç–∫–∞**: —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–æ—Ç–æ –∏–∑ –ë–î/–¥–∏—Å–∫–∞

---

## üìù –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: Backend —Å–µ—Å—Å–∏–∏ (30 –º–∏–Ω)

- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ `Session` –∏ `SessionPhoto` –≤ `models.py`
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoints –¥–ª—è —Å–µ—Å—Å–∏–π –≤ `app.py`
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
- [ ] –¢–µ—Å—Ç—ã endpoints

### –≠—Ç–∞–ø 2: Telegram Bot (60 –º–∏–Ω)

- [ ] –°–æ–∑–¥–∞—Ç—å `telegram_bot.py`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ç–æ
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend

### –≠—Ç–∞–ø 3: Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (45 –º–∏–Ω)

- [ ] –û–±–Ω–æ–≤–∏—Ç—å store —Å —Å–µ—Å—Å–∏—è–º–∏
- [ ] –°–æ–∑–¥–∞—Ç—å `DownloadQrScreen.tsx`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `UploadQrScreen.tsx` –¥–ª—è polling
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `UploadedPhotosScreen.tsx`
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR —Å session ID

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30 –º–∏–Ω)

- [ ] –°–∫–≤–æ–∑–Ω–æ–π —Ç–µ—Å—Ç upload flow
- [ ] –°–∫–≤–æ–∑–Ω–æ–π —Ç–µ—Å—Ç download flow
- [ ] –¢–µ—Å—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏
- [ ] –¢–µ—Å—Ç –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–π

---

## üöÄ –ù–∞—á–Ω—ë–º —Å –≠—Ç–∞–ø–∞ 1?

–°–æ–∑–¥–∞–¥–∏–º –º–æ–¥–µ–ª–∏ –∏ endpoints –¥–ª—è —Å–µ—Å—Å–∏–π!

---

**–§–∞–π–ª:** D:\fotobox+react\photobooth-magic-main\backend\TELEGRAM_BOT_–ü–õ–ê–ù.md
